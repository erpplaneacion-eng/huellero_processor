{% extends 'base.html' %}
{% load static %}

{% block title %}{{ area.nombre }}{% endblock %}

{% block container_class %}container-fluid{% endblock %}

{% block content %}
<!-- Navegaci√≥n de usuario -->
<nav class="user-nav">
    <div class="user-nav__info">
        <span>üë§</span>
        <span class="user-nav__name">{{ user.get_full_name|default:user.username }}</span>
        <span class="user-nav__area">({{ area.nombre }})</span>
    </div>
    <div>
        <a href="{% url 'users:logout' %}" class="user-nav__link">üö™ Cerrar Sesi√≥n</a>
    </div>
</nav>

<header class="header">
    <div class="header__icon">{{ area.icono }}</div>
    <h1 class="header__title">Huellero - {{ area.nombre }}</h1>
    <p class="header__subtitle">Corporaci√≥n Hacia un Valle Solidario</p>
</header>

<!-- Wrapper estrecho para el formulario y estados intermedios -->
<div class="form-wrapper">

    <!-- Formulario -->
    <section id="formSection">
        <!-- Carga de archivo -->
        <div class="card">
            <h2 class="card__title">
                <span class="card__title-icon">üìÅ</span>
                Archivo de Huellero
            </h2>
            <div class="upload-zone" id="uploadZone">
                <div class="upload-zone__icon">üì§</div>
                <div class="upload-zone__text">
                    Arrastra el archivo aqu√≠ o haz clic para seleccionar
                </div>
                <div class="upload-zone__hint">
                    Formatos aceptados: .xls, .xlsx
                </div>
            </div>
            <input type="file" id="fileInput" class="file-input" accept=".xls,.xlsx">
        </div>

        <!-- Opciones -->
        <div class="card">
            <h2 class="card__title">
                <span class="card__title-icon">‚öôÔ∏è</span>
                Opciones
            </h2>
            <label class="checkbox-wrapper">
                <input type="checkbox" id="usarMaestro" checked>
                <div>
                    <div class="checkbox-wrapper__label">Usar archivo maestro de empleados</div>
                    <div class="checkbox-wrapper__hint">Agrega el n√∫mero de documento a cada empleado</div>
                </div>
            </label>
        </div>

        <!-- Bot√≥n procesar -->
        <button id="btnProcesar" class="btn btn--primary" disabled>
            üöÄ Procesar Archivo
        </button>
    </section>

    <!-- Progreso -->
    <section id="progressSection" class="progress-section">
        <div class="card">
            <h2 class="card__title">
                <span class="card__title-icon">‚è≥</span>
                Procesando...
            </h2>
            <div class="progress-bar">
                <div class="progress-bar__fill" id="progressFill"></div>
            </div>
            <div class="progress-status" id="progressStatus">
                <span class="progress-status__icon">‚è≥</span>
                Iniciando...
            </div>
        </div>
    </section>

    <!-- Resultado (errores) -->
    <section id="resultSection" class="result-section">
        <!-- Se llena din√°micamente con JavaScript -->
    </section>

</div><!-- /form-wrapper -->

<!-- Dashboard de asistencia (ancho completo) -->
<section id="dashboardSection" class="dashboard-section" style="display:none">
    <!-- Renderizado din√°micamente por dashboard.js -->
</section>
{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<script>
    // Configuraci√≥n del √°rea
    const AREA_CONFIG = {
        key: '{{ area_key }}',
        nombre: '{{ area.nombre }}',
        apiProcesar: '{% url "logistica:procesar" %}',
        apiDescargar: '{% url "logistica:descargar" filename="PLACEHOLDER" %}'.replace('PLACEHOLDER/', ''),
        apiGuardarObs1: '{% url "logistica:guardar_obs1" %}'
    };
</script>
<script src="{% static 'js/dashboard.js' %}"></script>
<script src="{% static 'js/app.js' %}"></script>
{% endblock %}
