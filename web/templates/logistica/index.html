{% extends 'base.html' %}
{% load static %}

{% block title %}{{ area.nombre }}{% endblock %}

{% block container_class %}container-fluid{% endblock %}

{% block content %}
<nav class="user-nav">
    <div class="user-nav__info">
        <span>👤</span>
        <span class="user-nav__name">{{ user.get_full_name|default:user.username }}</span>
        <span class="user-nav__area">({{ area.nombre }})</span>
    </div>
    <div>
        <a href="{% url 'users:logout' %}" class="user-nav__link">🚪 Cerrar Sesion</a>
    </div>
</nav>

<header class="header">
    <div class="header__icon">{{ area.icono }}</div>
    <h1 class="header__title">Huellero - {{ area.nombre }}</h1>
    <p class="header__subtitle">Corporacion Hacia un Valle Solidario</p>
</header>

<section id="dashboardSection" class="dashboard-section">
    <div class="card">
        <h2 class="card__title">
            <span class="card__title-icon">⏳</span>
            Cargando dashboard...
        </h2>
        <p class="result__message">Consultando registros procesados.</p>
    </div>
</section>

<div id="cargaModal" class="carga-modal" aria-hidden="true">
    <div class="carga-modal__overlay" onclick="cerrarModalCarga()"></div>
    <div class="carga-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="cargaModalTitle">
        <div class="carga-modal__header">
            <h2 id="cargaModalTitle">Cargar Excel de Huellero</h2>
            <button type="button" class="carga-modal__close" onclick="cerrarModalCarga()">×</button>
        </div>
        <div class="carga-modal__body">
            <input type="file" id="fileInput" class="file-input" accept=".xls,.xlsx">
            <button id="btnSeleccionarArchivo" class="btn btn--primary">Seleccionar archivo</button>
            <p id="archivoSeleccionado" class="carga-modal__filename"></p>
            <div id="cargaEstado" class="carga-modal__estado"></div>
            <div id="cargaResumen" class="carga-modal__resumen"></div>
            <div class="carga-modal__actions">
                <button id="btnProcesarArchivo" class="btn btn--success" disabled>Procesar archivo</button>
                <button type="button" class="btn btn--primary" onclick="cerrarModalCarga()">Cancelar</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
<script>
    const AREA_CONFIG = {
        key: '{{ area_key }}',
        nombre: '{{ area.nombre }}',
        apiProcesar:        '{% url "logistica:procesar" %}',
        apiDescargar:       '{% url "logistica:descargar" filename="PLACEHOLDER" %}'.replace('PLACEHOLDER/', ''),
        apiGuardarObs1:          '{% url "logistica:guardar_obs1" %}',
        apiListarRegistros:      '{% url "logistica:listar_registros" %}',
        apiDescargarRegistros:   '{% url "logistica:descargar_registros_excel" %}',
    };
</script>
<script src="{% static 'js/dashboard.js' %}"></script>
<script src="{% static 'js/app.js' %}"></script>
{% endblock %}
